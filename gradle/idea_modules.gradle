
public void generateModulesFile(File mfile, Set<Project> subprojects) {
	def modulesFile = file("${mfile.getAbsolutePath()}/modules.xml")
	def header = '<?xml version="1.0" encoding="UTF-8"?>\n<project version="4">\n	<component name="ProjectModuleManager">\n		<modules>'
    def footer = '</modules></component></project>'
	modulesFile.text = header + '\n'
	
	evaluationDependsOnChildren()

 	subprojects.each { subproject -> 
		def imlPath = subproject.getProjectDir().getAbsolutePath() + '/' + subproject.name + '.iml'
		if (!subproject.name.equals('jenkins')) {
        	modulesFile.text += '<module fileurl="file://'+imlPath+'" filepath="'+imlPath+'" group="'+subproject.ideaGroupName+'"/>\n'
        }
	}

    modulesFile.text += '\n' + footer
}

ext.generateIdeaModulesFile = this.&generateModulesFile 